# Marzban Node Agent

**–õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞ –ª–æ–≥–æ–≤ Marzban —Å –Ω–æ–¥ –≤ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π Redis —Å–µ—Ä–≤–µ—Ä**

![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)
![Python 3.12+](https://img.shields.io/badge/python-3.12+-blue.svg)
![Docker](https://img.shields.io/badge/docker-supported-blue.svg)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

Marzban Node Agent - —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ–π –∏ –Ω–∞–¥–µ–∂–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–ª—è –ø–µ—Ä–µ—Å—ã–ª–∫–∏ –ª–æ–≥–æ–≤ –¥–æ—Å—Ç—É–ø–∞ Marzban —Å —É–¥–∞–ª–µ–Ω–Ω—ã—Ö –Ω–æ–¥ –Ω–∞ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω—ã–π —Å–µ—Ä–≤–µ—Ä —á–µ—Ä–µ–∑ Redis. –†–∞–±–æ—Ç–∞–µ—Ç –≤ Docker –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Å–ª–æ–∂–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- üîÑ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ `access.log` 
- üõ°Ô∏è **–ù–∞–¥–µ–∂–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞** - –ë—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—è –∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏
- ‚ö° **–ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ** - –û–¥–∏–Ω Docker Compose —Ñ–∞–π–ª
- üìä **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - Health checks –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- üîê **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏** - –¢–æ–ª—å–∫–æ Docker

## üöÄ Quick Start

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/your-repo/marzban-node-agent.git
cd marzban-node-agent

# –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
cp .env.example .env
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env
```bash
# –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
NODE_ID=node-001                # –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –Ω–æ–¥—ã
NODE_NAME=My Marzban Node       # –ò–º—è –Ω–æ–¥—ã
CENTRAL_REDIS_URL=redis://:password@host:6379/0  # URL Redis —Å–µ—Ä–≤–µ—Ä–∞
```

### 3. –ó–∞–ø—É—Å–∫
```bash
# –ü—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
./deploy.sh

# –ò–ª–∏ –≤—Ä—É—á–Ω—É—é
docker-compose up -d
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞
docker-compose ps

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

## üìã –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
docker-compose restart

# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ
git pull && docker-compose up -d --build

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f node-agent

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–í—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ —Ñ–∞–π–ª–µ `.env`:

```bash
# –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
NODE_ID=node-001                    # ID –Ω–æ–¥—ã
NODE_NAME=Germany-Frankfurt-01      # –ò–º—è –Ω–æ–¥—ã
CENTRAL_REDIS_URL=redis://:pass@host:6379/0  # Redis —Å–µ—Ä–≤–µ—Ä

# –ü—É—Ç—å –∫ –ª–æ–≥–∞–º (–≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞)  
ACCESS_LOG_PATH=/app/access.log

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
BUFFER_SIZE=50          # –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
FLUSH_INTERVAL=3.0      # –ò–Ω—Ç–µ—Ä–≤–∞–ª –æ—Ç–ø—Ä–∞–≤–∫–∏ (—Å–µ–∫)

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Redis
REDIS_CONNECTION_TIMEOUT=5
REDIS_SOCKET_TIMEOUT=5
REDIS_MAX_CONNECTIONS=10
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- **Docker** –∏ **Docker Compose**
- **–î–æ—Å—Ç—É–ø** –∫ —Ñ–∞–π–ª—É `/var/lib/marzban-node/access.log`
- **–°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ** –∫ —Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–æ–º—É Redis —Å–µ—Ä–≤–µ—Ä—É

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### Health Check
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ —á–µ—Ä–µ–∑ Docker
docker-compose ps

# –ü—Ä–æ–≤–µ—Ä–∫–∞ health check
docker inspect marzban-node-agent | grep Health -A 10
```

### –õ–æ–≥–∏
```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f

# –¢–æ–ª—å–∫–æ –∞–≥–µ–Ω—Ç
docker-compose logs -f node-agent

# –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
docker-compose logs --tail=100 node-agent
```

## üêõ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **Permission denied –Ω–∞ access.log**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–∞–≤–∞
   ls -la /var/lib/marzban-node/access.log
   
   # –ò—Å–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∞–≤–∞ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
   sudo chmod 644 /var/lib/marzban-node/access.log
   ```

2. **–ù–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Redis**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å URL –≤ .env
   # –§–æ—Ä–º–∞—Ç: redis://:password@host:port/db
   ```

3. **–§–∞–π–ª –ª–æ–≥–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω**
   ```bash
   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –≤ .env
   # –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ —Ñ–∞–π–ª —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –Ω–∞ —Ö–æ—Å—Ç–µ
   ```

## üìù –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
marzban-node-agent/
‚îú‚îÄ‚îÄ src/                    # –ò—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
‚îú‚îÄ‚îÄ .env.example           # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ .env                   # –í–∞—à–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ docker-compose.yml     # Docker Compose
‚îú‚îÄ‚îÄ Dockerfile            # Docker –æ–±—Ä–∞–∑
‚îú‚îÄ‚îÄ deploy.sh             # –°–∫—Ä–∏–ø—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ README.md             # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License
